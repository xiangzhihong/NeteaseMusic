import{m as Ee,a as W,g as Me,E as D,n as Ve}from"./event-3DiSBjGl.js";import{d as te,by as Ie,k as p,bz as Be,c,S as Ye,A as se,l as Le,x as we,o as h,w as f,b as i,T as Fe,f as y,n as Ce,g as d,u as a,s as I,a as _,r as L,K as Xe,U as ye,h as De,t as Se,y as He,bA as me,F as Ne,bl as je,E as Ke,H as ze,I as We,aj as pe,ak as ge,P as qe}from"./index-b8DxEvin.js";import{E as Ze,a as Ue,u as Ge}from"./index-vyc-TgTO.js";import{i as he,b as _e,d as Z,_ as $e,Q as Qe,R as Je,u as Oe,l as ea,E as A,m as aa,y as sa,z as ta,S as oa,T as na,U as la,V as ra,w as Te,N as ia,e as q,C as ca,W as ua,X as da}from"./base-BQVd69ut.js";import{u as Re,a as fa,k as va}from"./objects-JOKj_S0Y.js";import{a as ma}from"./scroll-BvtJi3kH.js";const pa=_e({urlList:{type:Z(Array),default:()=>Ee([])},zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},hideOnClickModal:Boolean,teleported:Boolean,closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},scale:{type:Number,default:1},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},showProgress:Boolean,crossorigin:{type:Z(String)}}),ga={close:()=>!0,error:u=>u instanceof Event,switch:u=>he(u),rotate:u=>he(u)},wa=te({name:"ElImageViewer"}),ya=te({...wa,props:pa,emits:ga,setup(u,{expose:oe,emit:b}){var g;const l=u,v={CONTAIN:{name:"contain",icon:Ie(Je)},ORIGINAL:{name:"original",icon:Ie(Qe)}};let H,j="";const{t:ne}=Re(),t=Oe("image-viewer"),{nextZIndex:P}=fa(),C=p(),B=p(),x=Be(),S=c(()=>{const{scale:e,minScale:r,maxScale:n}=l;return ea(e,r,n)}),$=p(!0),z=p(!1),m=p(l.initialIndex),Y=Ye(v.CONTAIN),o=p({scale:S.value,deg:0,offsetX:0,offsetY:0,enableTransition:!1}),le=p((g=l.zIndex)!=null?g:P()),U=c(()=>{const{urlList:e}=l;return e.length<=1}),F=c(()=>m.value===0),G=c(()=>m.value===l.urlList.length-1),X=c(()=>l.urlList[m.value]),re=c(()=>[t.e("btn"),t.e("prev"),t.is("disabled",!l.infinite&&F.value)]),Q=c(()=>[t.e("btn"),t.e("next"),t.is("disabled",!l.infinite&&G.value)]),J=c(()=>{const{scale:e,deg:r,offsetX:n,offsetY:N,enableTransition:T}=o.value;let E=n/e,R=N/e;const K=r*Math.PI/180,be=Math.cos(K),ke=Math.sin(K);E=E*be+R*ke,R=R*be-n/e*ke;const ve={transform:`scale(${e}) rotate(${r}deg) translate(${E}px, ${R}px)`,transition:T?"transform .3s":""};return Y.value.name===v.CONTAIN.name&&(ve.maxWidth=ve.maxHeight="100%"),ve}),ee=c(()=>`${m.value+1} / ${l.urlList.length}`);function M(){ce(),H?.(),document.body.style.overflow=j,b("close")}function ie(){const e=me(n=>{switch(Me(n)){case D.esc:l.closeOnPressEscape&&M();break;case D.space:ue();break;case D.left:de();break;case D.up:O("zoomIn");break;case D.right:fe();break;case D.down:O("zoomOut");break}}),r=me(n=>{const N=n.deltaY||n.deltaX;O(N<0?"zoomIn":"zoomOut",{zoomRate:l.zoomRate,enableTransition:!1})});x.run(()=>{W(document,"keydown",e),W(document,"wheel",r)})}function ce(){x.stop()}function s(){$.value=!1}function k(e){z.value=!0,$.value=!1,b("error",e),e.target.alt=ne("el.image.error")}function w(e){if($.value||e.button!==0||!C.value)return;o.value.enableTransition=!1;const{offsetX:r,offsetY:n}=o.value,N=e.pageX,T=e.pageY,E=me(K=>{o.value={...o.value,offsetX:r+K.pageX-N,offsetY:n+K.pageY-T}}),R=W(document,"mousemove",E);W(document,"mouseup",()=>{R()}),e.preventDefault()}function V(){o.value={scale:S.value,deg:0,offsetX:0,offsetY:0,enableTransition:!1}}function ue(){if($.value||z.value)return;const e=va(v),r=Object.values(v),n=Y.value.name,T=(r.findIndex(E=>E.name===n)+1)%e.length;Y.value=v[e[T]],V()}function ae(e){z.value=!1;const r=l.urlList.length;m.value=(e+r)%r}function de(){F.value&&!l.infinite||ae(m.value-1)}function fe(){G.value&&!l.infinite||ae(m.value+1)}function O(e,r={}){if($.value||z.value)return;const{minScale:n,maxScale:N}=l,{zoomRate:T,rotateDeg:E,enableTransition:R}={zoomRate:l.zoomRate,rotateDeg:90,enableTransition:!0,...r};switch(e){case"zoomOut":o.value.scale>n&&(o.value.scale=Number.parseFloat((o.value.scale/T).toFixed(3)));break;case"zoomIn":o.value.scale<N&&(o.value.scale=Number.parseFloat((o.value.scale*T).toFixed(3)));break;case"clockwise":o.value.deg+=E,b("rotate",o.value.deg);break;case"anticlockwise":o.value.deg-=E,b("rotate",o.value.deg);break}o.value.enableTransition=R}function Ae(e){var r;((r=e.detail)==null?void 0:r.focusReason)==="pointer"&&e.preventDefault()}function Pe(){l.closeOnPressEscape&&M()}function xe(e){if(e.ctrlKey){if(e.deltaY<0)return e.preventDefault(),!1;if(e.deltaY>0)return e.preventDefault(),!1}}return se(()=>S.value,e=>{o.value.scale=e}),se(X,()=>{Ne(()=>{const e=B.value;e?.complete||($.value=!0)})}),se(m,e=>{V(),b("switch",e)}),Le(()=>{ie(),H=W("wheel",xe,{passive:!1}),j=document.body.style.overflow,document.body.style.overflow="hidden"}),oe({setActiveItem:ae}),(e,r)=>(h(),we(a(Ue),{to:"body",disabled:!e.teleported},{default:f(()=>[i(Fe,{name:"viewer-fade",appear:""},{default:f(()=>[y("div",{ref_key:"wrapper",ref:C,tabindex:-1,class:d(a(t).e("wrapper")),style:Ce({zIndex:le.value})},[i(a(Ze),{loop:"",trapped:"","focus-trap-el":C.value,"focus-start-el":"container",onFocusoutPrevented:Ae,onReleaseRequested:Pe},{default:f(()=>[y("div",{class:d(a(t).e("mask")),onClick:Xe(n=>e.hideOnClickModal&&M(),["self"])},null,10,["onClick"]),I(" CLOSE "),y("span",{class:d([a(t).e("btn"),a(t).e("close")]),onClick:M},[i(a(A),null,{default:f(()=>[i(a(aa))]),_:1})],2),I(" ARROW "),a(U)?I("v-if",!0):(h(),_(ye,{key:0},[y("span",{class:d(a(re)),onClick:de},[i(a(A),null,{default:f(()=>[i(a(sa))]),_:1})],2),y("span",{class:d(a(Q)),onClick:fe},[i(a(A),null,{default:f(()=>[i(a(ta))]),_:1})],2)],64)),e.$slots.progress||e.showProgress?(h(),_("div",{key:1,class:d([a(t).e("btn"),a(t).e("progress")])},[L(e.$slots,"progress",{activeIndex:m.value,total:e.urlList.length},()=>[De(Se(a(ee)),1)])],2)):I("v-if",!0),I(" ACTIONS "),y("div",{class:d([a(t).e("btn"),a(t).e("actions")])},[y("div",{class:d(a(t).e("actions__inner"))},[L(e.$slots,"toolbar",{actions:O,prev:de,next:fe,reset:ue,activeIndex:m.value,setActiveItem:ae},()=>[i(a(A),{onClick:n=>O("zoomOut")},{default:f(()=>[i(a(oa))]),_:1},8,["onClick"]),i(a(A),{onClick:n=>O("zoomIn")},{default:f(()=>[i(a(na))]),_:1},8,["onClick"]),y("i",{class:d(a(t).e("actions__divider"))},null,2),i(a(A),{onClick:ue},{default:f(()=>[(h(),we(He(a(Y).icon)))]),_:1}),y("i",{class:d(a(t).e("actions__divider"))},null,2),i(a(A),{onClick:n=>O("anticlockwise")},{default:f(()=>[i(a(la))]),_:1},8,["onClick"]),i(a(A),{onClick:n=>O("clockwise")},{default:f(()=>[i(a(ra))]),_:1},8,["onClick"])])],2)],2),I(" CANVAS "),y("div",{class:d(a(t).e("canvas"))},[z.value&&e.$slots["viewer-error"]?L(e.$slots,"viewer-error",{key:0,activeIndex:m.value,src:a(X)}):(h(),_("img",{ref_key:"imgRef",ref:B,key:a(X),src:a(X),style:Ce(a(J)),class:d(a(t).e("img")),crossorigin:e.crossorigin,onLoad:s,onError:k,onMousedown:w},null,46,["src","crossorigin"]))],2),L(e.$slots,"default")]),_:3},8,["focus-trap-el"])],6)]),_:3})]),_:3},8,["disabled"]))}});var ha=$e(ya,[["__file","image-viewer.vue"]]);const ba=Te(ha),ka=_e({hideOnClickModal:Boolean,src:{type:String,default:""},fit:{type:String,values:["","contain","cover","fill","none","scale-down"],default:""},loading:{type:String,values:["eager","lazy"]},lazy:Boolean,scrollContainer:{type:Z([String,Object])},previewSrcList:{type:Z(Array),default:()=>Ee([])},previewTeleported:Boolean,zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},scale:{type:Number,default:1},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},showProgress:Boolean,crossorigin:{type:Z(String)}}),Ia={load:u=>u instanceof Event,error:u=>u instanceof Event,switch:u=>he(u),close:()=>!0,show:()=>!0},Ca=te({name:"ElImage",inheritAttrs:!1}),za=te({...Ca,props:ka,emits:Ia,setup(u,{expose:oe,emit:b}){const g=u,{t:l}=Re(),v=Oe("image"),H=je(),j=c(()=>ia(Object.entries(H).filter(([s])=>/^(data-|on[A-Z])/i.test(s)||["id","style"].includes(s)))),ne=Ge({excludeListeners:!0,excludeKeys:c(()=>Object.keys(j.value))}),t=p(),P=p(!1),C=p(!0),B=p(!1),x=p(),S=p(),$=q&&"loading"in HTMLImageElement.prototype;let z;const m=c(()=>[v.e("inner"),o.value&&v.e("preview"),C.value&&v.is("loading")]),Y=c(()=>{const{fit:s}=g;return q&&s?{objectFit:s}:{}}),o=c(()=>{const{previewSrcList:s}=g;return Ke(s)&&s.length>0}),le=c(()=>{const{previewSrcList:s,initialIndex:k}=g;let w=k;return k>s.length-1&&(w=0),w}),U=c(()=>g.loading==="eager"?!1:!$&&g.loading==="lazy"||g.lazy),F=()=>{q&&(C.value=!0,P.value=!1,t.value=g.src)};function G(s){C.value=!1,P.value=!1,b("load",s)}function X(s){C.value=!1,P.value=!0,b("error",s)}function re(s){s&&(F(),ee())}const Q=da(re,200,!0);async function J(){var s;if(!q)return;await Ne();const{scrollContainer:k}=g;if(ca(k))S.value=k;else if(qe(k)&&k!=="")S.value=(s=document.querySelector(k))!=null?s:void 0;else if(x.value){const V=ma(x.value);S.value=ua(V)?void 0:V}const{stop:w}=Ve(x,([V])=>{Q(V.isIntersecting)},{root:S});z=w}function ee(){!q||!Q||(z?.(),S.value=void 0,z=void 0)}function M(){o.value&&(B.value=!0,b("show"))}function ie(){B.value=!1,b("close")}function ce(s){b("switch",s)}return se(()=>g.src,()=>{U.value?(C.value=!0,P.value=!1,ee(),J()):F()}),Le(()=>{U.value?J():F()}),oe({showPreview:M}),(s,k)=>(h(),_("div",ze({ref_key:"container",ref:x},a(j),{class:[a(v).b(),s.$attrs.class]}),[P.value?L(s.$slots,"error",{key:0},()=>[y("div",{class:d(a(v).e("error"))},Se(a(l)("el.image.error")),3)]):(h(),_(ye,{key:1},[t.value!==void 0?(h(),_("img",ze({key:0},a(ne),{src:t.value,loading:s.loading,style:a(Y),class:a(m),crossorigin:s.crossorigin,onClick:M,onLoad:G,onError:X}),null,16,["src","loading","crossorigin"])):I("v-if",!0),C.value?(h(),_("div",{key:1,class:d(a(v).e("wrapper"))},[L(s.$slots,"placeholder",{},()=>[y("div",{class:d(a(v).e("placeholder"))},null,2)])],2)):I("v-if",!0)],64)),a(o)?(h(),_(ye,{key:2},[B.value?(h(),we(a(ba),{key:0,"z-index":s.zIndex,"initial-index":a(le),infinite:s.infinite,"zoom-rate":s.zoomRate,"min-scale":s.minScale,"max-scale":s.maxScale,"show-progress":s.showProgress,"url-list":s.previewSrcList,scale:s.scale,crossorigin:s.crossorigin,"hide-on-click-modal":s.hideOnClickModal,teleported:s.previewTeleported,"close-on-press-escape":s.closeOnPressEscape,onClose:ie,onSwitch:ce},We({toolbar:f(w=>[L(s.$slots,"toolbar",pe(ge(w)))]),default:f(()=>[s.$slots.viewer?(h(),_("div",{key:0},[L(s.$slots,"viewer")])):I("v-if",!0)]),_:2},[s.$slots.progress?{name:"progress",fn:f(w=>[L(s.$slots,"progress",pe(ge(w)))])}:void 0,s.$slots["viewer-error"]?{name:"viewer-error",fn:f(w=>[L(s.$slots,"viewer-error",pe(ge(w)))])}:void 0]),1032,["z-index","initial-index","infinite","zoom-rate","min-scale","max-scale","show-progress","url-list","scale","crossorigin","hide-on-click-modal","teleported","close-on-press-escape"])):I("v-if",!0)],64)):I("v-if",!0)],16))}});var Ea=$e(za,[["__file","image.vue"]]);const Ta=Te(Ea);export{Ta as E};
